name: ğŸ”¬ AI Clinical Research Intelligence Hub - Manual Deploy

on:
  # Manual trigger only - you control when it runs
  workflow_dispatch:
    inputs:
      deploy_message:
        description: 'Deployment message (optional)'
        required: false
        default: 'Manual deployment'
      
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    name: ğŸš€ Generate Brief & Deploy to GitHub Pages
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ Setup Python 3.9
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        cache: 'pip'
        
    - name: ğŸ“¦ Install Dependencies
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: ğŸ” Verify Environment Setup
      run: |
        python --version
        pip list | grep -E "(requests|feedparser|jinja2|pydantic)"
        
    - name: ğŸ¤– Run AI Clinical Research Pipeline
      env:
        OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
        GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
        GOOGLE_CSE_ID: ${{ secrets.GOOGLE_CSE_ID }}
      run: |
        echo "ğŸš€ Starting AI Clinical Research Intelligence Pipeline..."
        python pipeline.py
        echo "âœ… Pipeline completed successfully!"
        
    - name: ğŸ“Š Verify Generated Content
      run: |
        echo "ğŸ“ Checking generated files..."
        ls -la site/
        echo "ğŸ“„ HTML file size:"
        wc -l site/index.html
        echo "ğŸ“ˆ Brief data:"
        ls -la briefs/
        
    - name: ğŸŒ Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./site
        commit_message: |
          ğŸ”¬ Deploy AI Clinical Research Intelligence Hub
          
          ${{ github.event.inputs.deploy_message }}
          Generated on: ${{ steps.date.outputs.date }}
          Commit: ${{ github.sha }}
        user_name: 'github-actions[bot]'
        user_email: 'github-actions[bot]@users.noreply.github.com'
        
    - name: ğŸ“ Deployment Summary
      run: |
        echo "ğŸ‰ Deployment completed successfully!"
        echo "ğŸ”— Your site will be available at:"
        echo "   https://albertoclemente.github.io/ai-clinicalresearch-hub/"
        echo ""
        echo "ğŸ“Š Generated content summary:"
        if [ -f "briefs/$(date +%Y-%m-%d).json" ]; then
          echo "   âœ… Brief data: briefs/$(date +%Y-%m-%d).json"
        fi
        echo "   âœ… HTML site: site/index.html"
        echo "   âœ… Logs: logs/"
